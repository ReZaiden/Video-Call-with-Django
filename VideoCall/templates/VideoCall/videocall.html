{% load static %}
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Call - Django</title>
    <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="{% static 'VideoCall/css/style.css' %}" rel="stylesheet">
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h5>Calls</h5>
            <p>Hi {{ user.username }}</p>
        </div>

        <div class="new-call-section">
            <div class="input-group">
                <input type="text" id="peer-id" class="input-id" placeholder="Enter user ID...">
                <button id="call-btn" class="call-btn">
                    <svg viewBox="0 0 24 24"><path d="M20.6 14.2c-1.1 0-2.2-.3-3.2-.8-.4-.2-.9-.1-1.2.3l-1.4 1.4c-2.3-1.1-4.3-3.1-5.4-5.4l1.4-1.4c.4-.4.5-.9.3-1.3-.5-1-1-2.1-1-3.2 0-.5-.4-.9-.9-.9H5.7c-.5 0-.9.4-.9.9 0 7.7 6.3 14 14 14 .5 0 .9-.4.9-.9v-2.5c0-.5-.4-.9-.9-.9z"/></svg>
                </button>
            </div>
        </div>
        <p id="info-text"></p>
        <div class="history-title">Recent Calls</div>
        <div id="history-list" class="history-list">
        </div>
    </div>

    <!-- Main call area -->
    <div class="main-content">
        <div class="remote-video-container">
            <video id="remote-video" autoplay playsinline></video>
        </div>
        <div class="local-video-container">
            <video id="local-video" autoplay playsinline muted></video>
        </div>

        <!-- Call Control Buttons -->
        <div class="call-controls" id="call-controls">
            <button class="control-btn" id="mute-btn" title="Mute">
                <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15a.998.998 0 0 0-.98-.85c-.61 0-1.1.53-1 1.13C5.68 15.57 8.11 18 12 18v3h-2c-.55 0-1 .45-1 1s.45 1 1 1h4c.55 0 1-.45 1-1s-.45-1-1-1h-2v-3c3.89 0 6.32-2.43 6.91-5.87.1-.6-.39-1.13-1-1.13z"/></svg>
            </button>
            <button class="control-btn" id="video-btn" title="Camera Off">
                <svg viewBox="0 0 24 24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
            </button>
            <button class="control-btn danger" id="end-call-btn" title="End Call">
                <svg viewBox="0 0 24 24"><path d="M12 9c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2s2-.9 2-2v-6c0-1.1-.9-2-2-2zm7.71-5.71l-1.42-1.42L12 8.17 5.71 1.88 4.29 3.29 10.59 9.59 4.29 15.88l1.42 1.42L12 11.41l6.29 6.29 1.42-1.42L13.41 10l6.3-6.29z"/></svg>
            </button>
        </div>
    </div>

    <!-- Incoming call modal -->
    <div class="incoming-modal" id="incoming-modal">
        <div class="modal-content">
            <div class="caller-avatar">A</div>
            <div class="caller-name" id="caller-name">Alex Turner</div>
            <div class="caller-status">Calling...</div>
            <div class="call-actions">
                <button class="action-btn btn-reject" id="reject-btn">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/></svg>
                </button>
                <button class="action-btn btn-accept" id="accept-btn">
                    <svg viewBox="0 0 24 24"><path d="M20.6 14.2c-1.1 0-2.2-.3-3.2-.8-.4-.2-.9-.1-1.2.3l-1.4 1.4c-2.3-1.1-4.3-3.1-5.4-5.4l1.4-1.4c.4-.4.5-.9.3-1.3-.5-1-1-2.1-1-3.2 0-.5-.4-.9-.9-.9H5.7c-.5 0-.9.4-.9.9 0 7.7 6.3 14 14 14 .5 0 .9-.4.9-.9v-2.5c0-.5-.4-.9-.9-.9z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <script src="{% static 'VideoCall/js/main.js' %}"></script>
    <script>
        {% for call in call_logs %}
            {% if call.receiver == user %}
            ShowHistory("{{ call.caller.username }}", "{{  call.duration }}", "{{ call.call_start_time.time }}")
            {% else %}
            ShowHistory("{{ call.receiver.username }}", "{{  call.duration }}", "{{ call.call_start_time.time }}")
            {% endif %}
        {% endfor %}
    </script>
</body>
</html>